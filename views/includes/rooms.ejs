<div class="container">
    <h2><%= header %></h2>
    <form action="/rooms" id="form">
        <label for="orderby">Sort by:</label>
        <select id="orderby">
            <option value="" title="default">Default</option>
            <option value="asc" title="price" <% if(priceSortBy == "asc") {%> selected <% } %>>Price Low - High</option>
            <option value="desc" title="price" <% if(priceSortBy == "desc") {%> selected <% } %>>Price High - Low</option>
            <option value="asc" title="occupancy" <% if(occupancySortBy == "asc") {%> selected <% } %>>Occupancy Low - High</option>
            <option value="desc" title="occupancy" <% if(occupancySortBy == "desc") {%> selected <% } %>>Occupancy High - Low</option>
        </select>
    </form>

    <script>
    const url = new URL(window.location.href);  
    const urlParams = new URLSearchParams(url.search);
    const select = document.getElementById("orderby");

    select.addEventListener("change", () => {
        const index = select.selectedIndex;    

        if (index == 0) {
            urlParams.delete('price');
            urlParams.delete('occupancy');
            window.location.search = urlParams;
        } else if (index == 1 || index == 2) {
            const value = select.value;
            urlParams.set('price', value);
            urlParams.delete('occupancy');
            window.location.search = urlParams;
        } else if (index == 3 || index == 4) {
            const value = select.value;
            urlParams.set('occupancy', value);
            urlParams.delete('price');
            window.location.search = urlParams;   
        }
    });
    </script>

    <div class="grid">
        <% for (let i = 0; i < rooms.length; i += 1){ %>
        <div class="grid-item">
            <a href="/room?id=<%= rooms[i].id %>&checkin=<%= checkin %>&checkout=<%= checkout %>">
                <div class="room">
                    <div class="title">
                        <%= rooms[i].type %> Room
                    </div>
                    <div class="info">
                        <div id="price" title="Total price">
                            $<%= rooms[i].ppn * nights %>
                        </div>
                        <div id="guests" title="Maximum room occupancy capacity">
                            <div class="icon">
                                <span class="i guests"></span>
                            </div>
                            <span>
                                <%= rooms[i].occupancy %>
                            </span>
                        </div>
                    </div>
                </div>
            </a>
        </div>
        <% } %>
    </div> 
</div>